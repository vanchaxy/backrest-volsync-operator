# Default values for backrest-volsync-operator.

# By default, keep resource names consistent with the existing manifests.
fullnameOverride: backrest-volsync-operator

replicaCount: 1

image:
  repository: ghcr.io/jogotcha/backrest-volsync-operator
  tag: "0.2.0"
  pullPolicy: IfNotPresent

# Optional image pull secrets (e.g. for private GHCR)
imagePullSecrets: []

serviceAccount:
  create: true
  # If empty, defaults to the chart fullname
  name: ""

rbac:
  create: true

leaderElection:
  enabled: true

metrics:
  port: 8080
  # If empty, computed from port (":<port>")
  bindAddress: ""

healthProbe:
  port: 8081
  # If empty, computed from port (":<port>")
  bindAddress: ""

operatorConfig:
  # If true, the chart will create a BackrestVolSyncOperatorConfig CR in the release namespace.
  create: false
  # Name of BackrestVolSyncOperatorConfig in the release namespace.
  name: backrest-volsync-operator

  # Spec fields for the created BackrestVolSyncOperatorConfig.
  paused: false
  defaultBackrest:
    # Recommended when enabling auto-binding.
    url: ""
    authRef:
      name: ""

  # Policy for binding generation: Disabled | Annotated | All
  # This maps to spec.bindingGeneration.policy.
  bindingGeneration: Annotated

  # Optional restrict eligible VolSync kinds for auto-binding.
  # Allowed values: ReplicationSource | ReplicationDestination
  # If empty, both kinds are allowed.
  bindingGenerationKinds: []

  # Defaults applied to generated bindings.
  # These map to spec.bindingGeneration.defaultRepo on the OperatorConfig.
  defaultRepo:
    # Optional: automatically unlock the repo (if supported by Backrest).
    # Auto-unlock will remove lockfiles at the start of forget and prune operations.
    # This is potentially unsafe if the repo is shared by multiple client devices.
    # Disabled by default.
    # autoUnlock: true

    # Optional: automatically initialize the repo (if supported by Backrest).
    # autoInitialize: true

    # Optional: extra args passed to the Backrest repo/backup commands.
    # Example disables repository lock usage:
    # extraFlags:
    #   - "--no-lock"

    # Optional: list of environment variables allowed to be passed through.
    # envAllowlist:
    #   - "HTTPS_PROXY"
    #   - "NO_PROXY"

podSecurityContext:
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  runAsNonRoot: true

resources:
  requests:
    cpu: 10m
    memory: 64Mi
  limits:
    memory: 256Mi
